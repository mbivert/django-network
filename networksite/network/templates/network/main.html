<!DOCTYPE>
<html>
	<head>
		<meta charset="utf-8">
		<title>Network</title>
		<style>
			h2 {
				text-align   : center;
			}
			body {
				width        : 50%;
				margin-left  : 25%;
				margin-right : 25%;
			}
			.name {
				font-weight  : bold;
			}
			.post {
				margin-bottom : 1em;
				padding       : 1em;
				border        : 1px dashed;
			}
			.sitename {
				font-variant-caps : small-caps;
				font-size         : 1.5em;
				margin-right      : 1em;
			}
			.new-form .content {
				width  : 100%;
				height : 5em;
			}
			.login-form {
				margin-top : 2em;
			}
			.post-submit, .login-submit {
				float : right;
			}
			.new-form {
				margin-top : 2em;
				/* clumsy: add space for the floating .submit-post button */
				margin-bottom : 2em;
			}
			.errorlist {
				text-align       : center;
				color            : red;
				font-size        : 2em;
				background-color : lightgoldenrodyellow;
				font-weight      : bold;
				list-style-type  : none;
			}
			.helptext {
				font-size        : x-small;
			}
			.login-form-field {
				width                 : 50%;
				margin-left           : 25%;
				display               : grid;
				grid-template-columns : 1fr 3fr;
			}
		</style
	</head>
	<body>
		<nav>
			<span class="sitename">Network</span>
			<a href="{% url 'network:home' %}">All posts</a>
			{% if user.is_authenticated %}
				<a href="{% url 'network:logout'    %}">Logout</a>
				<a href="{% url 'network:signout'   %}">Sign-out</a>
			{% else %}
				<a href="{% url 'network:login'    %}">Login</a>
				<a href="{% url 'network:signin'   %}">Sign-in</a>
			{% endif %}
		</nav>
	{% block content %}
		<p>hello, world!</p>
	{% endblock %}
	</body>
	<script>window.addEventListener("load", function() {
		// NOTE: For better or for worse, that's how it's supposed to
		// be done; see https://docs.djangoproject.com/en/5.1/howto/csrf/
		function getCookie(name) {
			let cookieValue = null;
			if (document.cookie && document.cookie !== '') {
				const cookies = document.cookie.split(';');
				for (let i = 0; i < cookies.length; i++) {
					const cookie = cookies[i].trim();
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) === (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
		const csrftoken = getCookie('csrftoken');

		document.addEventListener("click", async function(e) {
			let p = e.target;

			if (p.classList.contains('delete-link')) {
				e.preventDefault()
				e.stopPropagation()
				if (confirm("Are you sure you want to delete this post?")) {
					let r = await fetch(p.href, {
						method      : "POST",
						headers     : {'X-CSRFToken': csrftoken},
						credentials : "same-origin",
					})
					let err = "", msg = "";

					if (!r.ok)
						err = "request failed!"
					else try {
						let x = await r.json()
						err = x.err; msg = x.msg;
					} catch(y) { err = y }

					if (err != "") {
						alert(err);
						return;
					}
					alert(msg);
					p.closest(".post").remove()
				}
				return false
			}
		})
	});</script>
</html>